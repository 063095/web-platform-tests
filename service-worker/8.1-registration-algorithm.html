<!DOCTYPE html>
<html>
<title>Service Workers: Registration</title>
    <head>
        <link rel="help" href="https://slightlyoff.github.io/ServiceWorker/spec/service_worker/#registration-algorithm">
        <script src="/resources/testharness.js"></script>
        <script src="/resources/testharnessreport.js"></script>
    
    </head>
    <body>

<!--

The [Service Worker Registration Algorithm][1] creates or updates a
[registration][2] for some amount of [URL scope][3]. If successful, a
registration ties the provided `scriptUrl` to an [origin][4] + `scope` pair
which is subsequently consulted by the user for [navigation matching][5].

Input:
    `scriptUrl`, the URL of the script to register; a string
    `scope`, a string representing a [path expression][6] of [URL scope][3]
Output:
    `promise`, a [promise][7] whose resolution indicates the success or failure
    of the algorithm
1.  Let `promise` be a newly-created [promise][7].
2.  Return `promise`.
3.  Run the following steps asynchronously:
    1.  Let `scope` be `scope` resolved against the document URL.
    2.  Let `scope` be `scope` with the fragment part, "`#`" concatenated
        with `scope`'s [fragment][8], removed, if any.
    3.  Let `scriptUrl` be `scriptUrl` resolved against the document URL.
    4.  Let `scriptUrl` be `scriptUrl` with the fragment part, "`#`"
        concatenated with `scriptUrl`'s [fragment][8], removed, if any.
    5.  If the scheme of the document URL is not `https`, then: // Browsers
        may ignore this rule for development purposes only.
        1.  Reject `promise` with a new `SecurityError`.
        2.  Abort these steps.
    6.  If the origin of `scriptUrl` does not match the document's origin, then:
        1.  Reject `promise` with a new `SecurityError`.
        2.  Abort these steps.
    7.  If the origin of `scope` does not match the document's origin, then:
        1.  Reject `promise` with a new `SecurityError`.
        2.  Abort these steps.
    8.  Let `serviceWorkerRegistration` be the result of running the
        [_GetRegistration algorithm][9] passing `scope` as the argument.
    9.  If `serviceWorkerRegistration` is not null, then:
        1.  Set `serviceWorkerRegistration.uninstalling` to false.
        2.  If `scriptUrl` is equal to
            `serviceWorkerRegistration.scriptUrl`, then:
            1.  If `serviceWorkerRegistration.updatePromise` is not null, then:
                1.  Resolve `promise` with
                    `serviceWorkerRegistration.updatePromise`.
                2.  Abort these steps.
            2.  Let newestWorker be the result of running the
                [_GetNewestWorker algorithm][10] passing
                `serviceWorkerRegistration` as the argument.
            3.  If newestWorker is not null, then:
                1.  Resolve promise with `newestWorker`.
                2.  Abort these steps.
    10. If `serviceWorkerRegistration` is null, then:
        1.  Let `serviceWorkerRegistration` be a newly-created
            [_ServiceWorkerRegistration][2] object.
        2.  Set `serviceWorkerRegistration` to the value of key `scope` in
            [_ScopeToServiceWorkerRegistrationMap][11].
        3.  Set `serviceWorkerRegistration`.`scope` to `scope`.
        4.  Set `serviceWorkerRegistration`.`uninstalling` to false.
    11. Set `serviceWorkerRegistration`.`scriptUrl` to `scriptUrl`.
    12. Resolve `promise` with the result of running the [_Update
        algorithm][12] passing `serviceWorkerRegistration` as the argument.



[1]: #registration-algorithm
[2]: #registration-internal-interface
[3]: #url-scope
[4]: http://goo.gl/56C6hc
[5]: #scope-match-algorithm
[6]: #path-expression
[7]: http://goo.gl/3TobQS
[8]: http://goo.gl/ld1M50
[9]: #get-registration-algorithm
[10]: #get-newest-worker-algorithm
[11]: #scope-to-service-worker-registration-map-internal-interface
[12]: #update-algorithm

-->



    <script>
        test(function() {
            // not_implemented();
        }, "There are no tests for section Registration so far.");
    </script>

    </body>
</html>

