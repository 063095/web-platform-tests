<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    	<meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>CSS Test: transitionend event for shorthand property</title>
        <meta name="assert" content="Test checks that all transitionend events are triggered for shorthand property">
        <link rel="help" href="http://www.w3.org/TR/css3-transitions/#transition-property-property">
        <link rel="help" href="http://www.w3.org/TR/css3-transitions/#transition-events">
        <link rel="author" title="Rodney Rehm" href="http://rodneyrehm.de/en/">
        <meta name="flags" content="dom">
        
        <script src="/resources/testharness.js" type="text/javascript"></script>
        <script src="/resources/testharnessreport.js" type="text/javascript"></script>
        
        <script src="./support/helper.js" type="text/javascript"></script>
        <script src="./support/runAsyncHarness.js" type="text/javascript"></script>
        <script src="./support/generalTest.js" type="text/javascript"></script>
        <script src="./support/properties.js" type="text/javascript"></script>
    </head>
    <body>
        <!-- required by testharnessreport.js -->
        <div id="log"></div>
        <!-- elements used for testing -->
        <div id="fixture">
            <div id="container">
                <div id="transition">Hello World</div>
            </div>
        </div>

        <script>
            // For the keyword ‘all’, or if one of the identifiers listed is a shorthand property, implementations must 
            // start transitions for any of its longhand sub-properties that are animatable (or, for ‘all’, all animatable 
            // properties), using the duration, delay, and timing function at the index corresponding to the shorthand.
        
            // this test takes its time, give it 5 minutes to run
            setup({timeout: 300000});
            // init dom
            domFixture('#fixture');
            
            var tests = [
                {
                    name: "transition:all, changing padding-left",
                    transitions: 'all .1s linear .01s',
                    from: {'padding-left': '1px'},
                    to: {'padding-left': '10px'},
                    expect: [
                        'padding-left:0.1s' 
                    ]
                }, {
                    name: "transition:all, changing padding",
                    transitions: 'all .1s linear .01s',
                    from: {'padding': '1px'},
                    to: {'padding': '10px'},
                    expect: [
                        'padding-top:0.1s',
                        'padding-right:0.1s',
                        'padding-bottom:0.1s',
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:all, changing padding but not padding-bottom",
                    transitions: 'all .1s linear .01s',
                    from: {'padding': '1px 1px 1px 1px'},
                    to: {'padding': '10px 10px 1px 10px'},
                    expect: [
                        'padding-top:0.1s',
                        'padding-right:0.1s',
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:padding, changing padding-left",
                    transitions: 'padding .1s linear .01s',
                    from: {'padding-left': '1px'},
                    to: {'padding-left': '10px'},
                    expect: [
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:padding, changing padding",
                    transitions: 'padding .1s linear .01s',
                    from: {'padding': '1px'},
                    to: {'padding': '10px'},
                    expect: [
                        'padding-top:0.1s',
                        'padding-right:0.1s',
                        'padding-bottom:0.1s',
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:padding, changing padding but not padding-bottom",
                    transitions: 'padding .1s linear .01s',
                    from: {'padding': '1px 1px 1px 1px'},
                    to: {'padding': '10px 10px 1px 10px'},
                    expect: [
                        'padding-top:0.1s',
                        'padding-right:0.1s',
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:padding-left, changing padding-left",
                    transitions: 'padding-left .1s linear .01s',
                    from: {'padding-left': '1px'},
                    to: {'padding-left': '10px'},
                    expect: [
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:padding-left, changing padding",
                    transitions: 'padding-left .1s linear .01s',
                    from: {'padding': '1px'},
                    to: {'padding': '10px'},
                    expect: [
                        'padding-left:0.1s'
                    ]
                }, {
                    name: "transition:padding-left, changing padding but not padding-bottom",
                    transitions: 'padding-left .1s linear .01s',
                    from: {'padding': '1px 1px 1px 1px'},
                    to: {'padding': '10px 10px 1px 10px'},
                    expect: [
                        'padding-left:0.1s'
                    ]
                }
            ];
            
            // missing support for requestAnimationFrame forces us to
            // run animations at a slower pace, so setTimeout has a
            // chance of being invoked before TransitionEnd
            var duration = getRequestAnimationFrame() ? '0.1s' : '0.5s';

            runAsyncHarness({
                // array of test data
                tests: tests,
                // milliseconds to wait before calling teardown and ending test
                duration: parseFloat(duration) * 1000,
                // prepare individual test
                setup: generalTest.setup,
                // cleanup after individual test
                teardown: generalTest.teardown,
                // run actual test, assertions can be used here!
                test: function(data, options) {
                    var styles = {
                        '#fixture': {},

                        '#container': {},
                        '#container.to': {},
                        '#container.transition': {},
                        
                        '#transition': data.from,
                        '#transition.to' : data.to,
                        '#transition.transition' : {transition: data.transitions}
                    };
                    
                    // prepare styles
                    setStyle(styles);
                    // kick off the transition
                    generalTest.startTransition(data);
                },
                // run tests immediately before teardown, assertions can be used here!
                concluding: function(data) {
                    // make sure we got the event for the tested property only
                    data.test.step(generalTest.assertExpectedEventsFunc(data, 'transition', data.expect));
                },
                
                // called once all tests are done
                done: generalTest.done
            });
        </script>
    </body>
</html>