<!DOCTYPE HTML>
<title>Margin Collapsing with Clearance</title>
<style>
div.example { float:left; width:190px; height:420px; margin:10px; padding:10px; border:1px solid black; }
div.example h2 { height:20px; }
div.container { width:150px; height:220px; position:relative; margin-left:10px;}
div.number { float:left; height:20px; width:20px; text-align:center; font:14px/16px; font-weight:bold; }
div.notes { xheight:100px; }
div.distance { font-style:italic; }

/* common styles. Blue and green boxes are 50px tall. Green box always have 50px top margin. */
div.box1 {
	height:50px;
	margin:0;
	background-color: lightblue;
}
div.box2 {
	background-color: red;
	float:left;
	width: 20px;
	height: 20px;
}
div.parentof2and3 {
	margin:0;
	background-color: khaki;
}
div.box3 {
	overflow:hidden; /* this makes the whole block avoid overlapping floats */
	margin-top: 50px;
	height:50px;
	width:140px;
	background-color: lightgreen;
}
div.target1 { position:absolute; left:-10px; height:50px; width:0; border-left:2px solid lightblue; }
div.target2 { position:absolute; left:-10px; height:20px; width:0; border-left:2px solid red; }
div.target3 { position:absolute; left:-10px; height:50px; width:0; border-left:2px solid lightgreen; }

/* example 0 should work everywhere. without a float the collapsed margins are 50px */
.x0 .box2 { display:none; }

.x0 .target1 { top:0px; }
.x0 .target2 { display:none; }
.x0 .target3 { top:100px; }

/* example 1 */
.x1 .parentof2and3 {display:inline; }

.x1 .target1 { top:0px; }
.x1 .target2 { top:50px; }
.x1 .target3 { top:100px; }

/* example 2 */
.x2 .parentof2and3 {display:inline; }
.x2 .box3 { clear:left; }

.x2 .target1 { top:0px; }
.x2 .target2 { top:50px; }
.x2 .target3 { top:100px; }

/* example 3 */
.x3 .box1 { margin-bottom:40px;}
.x3 .parentof2and3 {display:inline; }
.x3 .box3 { clear:left; }

.x3 .target1 { top:0px; }
.x3 .target2 { top:90px; }
.x3 .target3 { top:110px; }

/* example 4 */

.x4 .target1 { top:0px; }
.x4 .target2 { top:100px; }
.x4 .target3 { top:120px; }

/* example 5 */
.x5 .box3 { clear:left;}

.x5 .target1 { top:0px; }
.x5 .target2 { top:100px; }
.x5 .target3 { top:120px; }

/* example 3a */
.x3a .box1 { margin-bottom:40px;}
.x3a .parentof2and3 {display:inline; }
.x3a .box3 { clear:left; }

.x3a .target1 { top:0px; }
.x3a .target2 { top:90px; }
.x3a .target3 { top:150px; }

/* example 5a */
.x5a .box3 { clear:left;}

.x5a .target1 { top:0px; }
.x5a .target2 { top:50px; }
.x5a .target3 { top:120px; }

</style>

</head>

<body>
<p>
The following examples show a div (green) with margin-top:50px. In all cases we expect it to be at least that far from previous block (blue).
</p>
<div class="example x0">
	<h2>Example 0</h2>
	<div class="container">
		<div class="target1"></div><div class="target2"></div><div class="target3"></div>
		<div class="box1">
			<div class="number">1.</div>
			margin:0;
		</div>
		<div class="parentof2and3">
			<div class="box2">
				<div class="number">2.</div>
			</div>
			<div class="box3">
				<div class="number">3.</div>
				margin-top:50px;
			</div>
		</div>
	</div>
	<div class="notes">
		Float is display:none. The effective margin is 50px. Boxes 1 and 3 should never be closer than this.
	</div>
	<div class="distance">
		from 1 to 3: 50px;
	</div>
</div>

<div class="example x1">
	<h2>Example 1</h2>
	<div class="container">
		<div class="target1"></div><div class="target2"></div><div class="target3"></div>
		<div class="box1">
			<div class="number">1.</div>
			margin:0;
		</div>
		<div class="parentof2and3">
			<div class="box2">
				<div class="number">2.</div>
			</div>
			<div class="box3">
				<div class="number">3.</div>
				margin-top:50px;
			</div>
		</div>
	</div>
	<div class="notes">
		float fits within the margin. it doesn't affect results of margin collapsing.
	</div>
	<div class="distance">
		from 1 to 3: 50px;
	</div>
</div>

<div class="example x2">
	<h2>Example 2</h2>
	<div class="container">
		<div class="target1"></div><div class="target2"></div><div class="target3"></div>
		<div class="box1">
			<div class="number">1.</div>
			margin:0;
		</div>
		<div class="parentof2and3">
			<div class="box2">
				<div class="number">2.</div>
			</div>
			<div class="box3">
				<div class="number">3.</div>
				margin-top:50px;
				<br />
				clear:left;
			</div>
		</div>
	</div>
	<div class="notes">
		although box 3 has 'clear:left' there is enough space and clearance is not present
	</div>
	<div class="distance">
		from 1 to 3: 50px;
	</div>
</div>

<div class="example x3">
	<h2>Example 3</h2>
	<div class="container">
		<div class="target1"></div><div class="target2"></div><div class="target3"></div>
		<div class="box1">
			<div class="number">1.</div>
			margin-bottom:40px;
		</div>
		<div class="parentof2and3">
			<div class="box2">
				<div class="number">2.</div>
			</div>
			<div class="box3">
				<div class="number">3.</div>
				margin-top:50px;
				<br />
				clear:left;
			</div>
		</div>
	</div>
	<div class="notes">
		clearance is added to make box3 clear the float
	</div>
	<div class="distance">
		from 1 to 2: 40px;
	</div>
	<div class="distance">
		from 1 to 3: 60px;
	</div>
</div>

<div class="example x4">
	<h2>Example 4</h2>
	<div class="container">
		<div class="target1"></div><div class="target2"></div><div class="target3"></div>
		<div class="box1">
			<div class="number">1.</div>
			margin:0;
		</div>
		<div class="parentof2and3">
			<div class="box2">
				<div class="number">2.</div>
			</div>
			<div class="box3">
				<div class="number">3.</div>
				margin-top:50px;
			</div>
		</div>
	</div>
	<div class="notes">
		2 and 3 share the parent block container. margin of 3 should put the container 50px below 1. 3 is pushed further down by the float.
	</div>
	<div class="distance">
		from 1 to 2: 50px;
	</div>
	<div class="distance">
		from 1 to 3: 70px;
	</div>
</div>

<div class="example x5">
	<h2>Example 5</h2>
	<div class="container">
		<div class="target1"></div><div class="target2"></div><div class="target3"></div>
		<div class="box1">
			<div class="number">1.</div>
			margin:0;
		</div>
		<div class="parentof2and3">
			<div class="box2">
				<div class="number">2.</div>
			</div>
			<div class="box3">
				<div class="number">3.</div>
				margin-top:50px;
				<br />
				clear:left;
			</div>
		</div>
	</div>
	<div class="notes">
		3 has clear:left. it is under the float. before clearing the float margin of 3 is collapsed with parent container.
		<br />
		<strong>expect same result as ex.4</strong>
	</div>
	<div class="distance">
		from 1 to 2: 50px;
	</div>
	<div class="distance">
		from 1 to 3: 70px;
	</div>
</div>

<p style="clear:both">
The above examples have expectations set based on reading of 9.5.2 as a two-step process of collapsing margins, then adding clearance as necessary. Margins are not re-collapsed after clearance is applied.
</p>

</body>
</html>
